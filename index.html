<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TBC å´‡æ‹œæœäº‹æŸ¥è©¢ç³»çµ±</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="importmap">
    {
        "imports": {
            "react": "https://esm.sh/react@18.2.0",
            "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
            "lucide-react": "https://esm.sh/lucide-react@0.344.0?external=react,react-dom"
        }
    }
    </script>

    <style>
        body { background-color: #f8fafc; font-family: sans-serif; }
        .animate-in { animation: fadeIn 0.5s ease-out forwards; opacity: 0; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script>
        window.onerror = function(msg, url, line, col, error) {
            const root = document.getElementById('root');
            if(root) {
                root.innerHTML = `
                    <div style="color:red; background:#fee; padding:20px; margin:20px; border-radius:10px;">
                        <h3>âŒ ç¨‹å¼ç™¼ç”ŸéŒ¯èª¤</h3>
                        <p>${msg}</p>
                    </div>`;
            }
            return false;
        };
    </script>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useMemo } from 'react';
        import { createRoot } from 'react-dom/client';
        import { 
          Calendar, Clock, User, LogOut, Heart, Monitor, Users, Smile, BookOpen, 
          Coffee, CheckCircle, Info, RefreshCw, Wifi, Database, AlertCircle, 
          ArrowLeft, Search, UserCheck, BarChart, ArrowRight, UserX, Briefcase, Link as LinkIcon, Activity, MessageCircle, Send,
          ArrowLeftRight, HandHeart
        } from 'lucide-react';

        const API_URL = "https://script.google.com/macros/s/AKfycbwooXPX-T7GnXQl-gXbOHmHZjSOD5Po5KK0LmoavdT0i260qerMbl2necQG4vo57fXh7g/exec";

        const ROLE_CONFIG = {
          'å¸æœƒ': { color: 'bg-purple-100 text-purple-700 border-purple-200', icon: User },
          'åŸ·äº‹è¼ªå€¼': { color: 'bg-indigo-100 text-indigo-700 border-indigo-200', icon: BookOpen },
          'æ¥å¾…': { color: 'bg-blue-100 text-blue-700 border-blue-200', icon: Users },
          'æ”¶å¥‰ç»': { color: 'bg-green-100 text-green-700 border-green-200', icon: Heart },
          'ä¸»é¤': { color: 'bg-red-100 text-red-700 border-red-200', icon: Coffee },
          'PPT': { color: 'bg-orange-100 text-orange-700 border-orange-200', icon: Monitor },
          'æ–°æœ‹å‹é—œæ‡·': { color: 'bg-pink-100 text-pink-700 border-pink-200', icon: Smile },
          'é è¨­': { color: 'bg-slate-50 text-slate-400 border-slate-100', icon: Clock }
        };

        const DEFAULT_SCHEDULE = [];
        const DEFAULT_PEOPLE_DATA = [];
        const DEFAULT_STATS = { "DEFAULT": 0 };

        // --- Helper Functions ---
        const normalizeDateStr = (d) => {
            if (!d) return '';
            const str = String(d);
            if (str.includes('T')) {
                const date = new Date(str);
                return `${date.getFullYear()}/${date.getMonth()+1}/${date.getDate()}`;
            }
            const parts = str.split('/');
            if (parts.length === 3) return `${parseInt(parts[0])}/${parseInt(parts[1])}/${parseInt(parts[2])}`;
            return str;
        };

        const parseDateObj = (dStr) => {
            const norm = normalizeDateStr(dStr);
            if (!norm) return new Date(9999, 11, 31);
            const parts = norm.split('/');
            return new Date(parts[0], parts[1] - 1, parts[2]);
        };

        const sheetToObjects = (rows) => {
          if (!rows || rows.length < 2) return [];
          const headers = rows[0];
          return rows.slice(1).map(row => {
            const obj = {};
            headers.forEach((h, i) => { obj[h] = row[i]; });
            return obj;
          });
        };

        const processStatsData = (rawRows) => {
          const stats = {};
          if (!Array.isArray(rawRows)) return stats;
          const isObjectArray = !Array.isArray(rawRows[0]);
          const dataRows = isObjectArray ? rawRows : rawRows.slice(1);
          dataRows.forEach(row => {
            let rowObj = isObjectArray ? row : {};
            if (!isObjectArray) rawRows[0].forEach((h, i) => { rowObj[h] = row[i]; });
            
            const nameKey = Object.keys(rowObj).find(k => k.includes('å§“å') || k.toLowerCase() === 'name');
            const countKey = Object.keys(rowObj).find(k => k.includes('ç¸½æ¬¡æ•¸') || k.includes('count'));
            if (nameKey && countKey) {
              const name = rowObj[nameKey];
              const count = parseInt(rowObj[countKey]);
              if (name && !isNaN(count)) stats[name] = count;
            }
          });
          return stats;
        };

        // â˜…â˜…â˜… è¬èƒ½è®€å–é‚è¼¯ï¼šç¢ºä¿æŠ“åˆ° Group å’Œ Session2 â˜…â˜…â˜…
        const processPeopleData = (rawData) => {
          if (!Array.isArray(rawData) || rawData.length === 0) return [];

          const isObjectArray = !Array.isArray(rawData[0]);
          const dataRows = isObjectArray ? rawData : rawData.slice(1); 

          return dataRows.map((row, index) => {
            // 1. è½‰æˆ Key-Value ç‰©ä»¶ä»¥åˆ©æœå°‹
            let rowObj = row;
            if (!isObjectArray) {
                rowObj = {};
                rawData[0].forEach((h, i) => { rowObj[h] = row[i]; });
            }
            // 2. è½‰æˆ Value é™£åˆ—ä»¥åˆ©ä½ç½®æœå°‹
            const rowValues = Object.values(rowObj);

            // åŸºç¤æ¬„ä½
            const nameKey = Object.keys(rowObj).find(k => k.includes('å§“å') || k.toLowerCase() === 'name');
            const name = nameKey ? rowObj[nameKey] : '';
            
            const sessionKey = Object.keys(rowObj).find(k => k.includes('æœäº‹æ™‚æ®µ') || k.includes('session'));
            const session = sessionKey ? rowObj[sessionKey] : 'çš†å¯';

            const unavailableKey = Object.keys(rowObj).find(k => k.includes('ä¸èƒ½åƒèˆ‡') || k.includes('unavailable'));
            const unavailable = unavailableKey ? rowObj[unavailableKey] : '';

            const willingnessKey = Object.keys(rowObj).find(k => k.includes('æœäº‹æ„é¡˜') || k.includes('willingness'));
            const willingness = willingnessKey ? String(rowObj[willingnessKey]) : '';

            // â˜…â˜…â˜… ç­–ç•¥ 1ï¼šä½ç½®è®€å– (Bæ¬„=Index 1, Fæ¬„=Index 5) â˜…â˜…â˜…
            // é€™æ˜¯æœ€ç©©çš„æ–¹æ³•ï¼Œå‡è¨­ GAS å›å‚³çš„ç‰©ä»¶é †åºæ˜¯æ­£ç¢ºçš„
            let groupId = String(rowValues[1] || '').toUpperCase().trim();
            let session2 = String(rowValues[5] || '').trim();

            // â˜…â˜…â˜… ç­–ç•¥ 2ï¼šå¦‚æœç­–ç•¥ 1 æ²’æŠ“åˆ°ï¼Œå˜—è©¦é—œéµå­—æœå°‹ â˜…â˜…â˜…
            if (groupId !== 'FA' && groupId !== 'FB') {
                const key = Object.keys(rowObj).find(k => k.includes('ID') || k.includes('ç¾¤çµ„'));
                if (key) groupId = String(rowObj[key] || '').toUpperCase().trim();
            }
            if (session2 !== '1' && session2 !== '2') {
                const key = Object.keys(rowObj).find(k => k.includes('äºŒå ‚') || k.includes('2å ‚') || k.includes('ä¸»æ—¥'));
                if (key) session2 = String(rowObj[key] || '').trim();
            }

            // â˜…â˜…â˜… ç­–ç•¥ 3ï¼šæš´åŠ›æƒæ (å¦‚æœæ¨™é¡Œå…¨éŒ¯ï¼Œå…§å®¹å°ä¹Ÿå¯ä»¥) â˜…â˜…â˜…
            if (groupId !== 'FA' && groupId !== 'FB') {
                // æƒææ‰€æœ‰æ¬„ä½ï¼Œçœ‹æœ‰æ²’æœ‰ "FA" æˆ– "FB"
                const found = rowValues.find(v => String(v).toUpperCase().trim() === 'FA' || String(v).toUpperCase().trim() === 'FB');
                if (found) groupId = String(found).toUpperCase().trim();
            }

            // DEBUG ç¬¬ä¸€ç­†
            if (index === 0) {
                console.log(`[é™¤éŒ¯] ç¬¬ä¸€äºº: ${name}`);
                console.log(` - æœ€çµ‚åˆ¤å®š Group: ${groupId}`);
                console.log(` - æœ€çµ‚åˆ¤å®š Session2: ${session2}`);
                console.log(` - åŸå§‹è³‡æ–™:`, rowObj);
            }

            // è™•ç†å´—ä½
            const roles = {};
            Object.keys(ROLE_CONFIG).forEach(roleName => {
              // å¿…é ˆç²¾æº–å°æ‡‰æ¬„ä½åç¨±
              const key = Object.keys(rowObj).find(k => k.trim() === roleName);
              if (key && rowObj[key]) roles[roleName] = "O";
            });

            return { name, session, unavailable, willingness, roles, groupId, session2 };
          }).filter(p => p.name);
        };

        // --- App Component ---
        function App() {
          const [currentView, setCurrentView] = useState('login'); 
          const [name, setName] = useState('');
          const [loginError, setLoginError] = useState('');
          const [swapRequest, setSwapRequest] = useState(null); 
          const [scheduleData, setScheduleData] = useState(DEFAULT_SCHEDULE);
          const [peopleData, setPeopleData] = useState(DEFAULT_PEOPLE_DATA);
          const [statsData, setStatsData] = useState(DEFAULT_STATS);
          const [isSyncing, setIsSyncing] = useState(false);
          const [syncStatus, setSyncStatus] = useState('');
          const [debugInfo, setDebugInfo] = useState({});

          useEffect(() => {
            const loadAllData = async () => {
              setIsSyncing(true);
              setSyncStatus('æ­£åœ¨è«‹æ±‚è³‡æ–™...');
              try {
                const [resSchedule, resData, resStats] = await Promise.all([
                  fetch(`${API_URL}?type=schedule_view`).then(r => r.json()), 
                  fetch(`${API_URL}?type=data_view`).then(r => r.json()),     
                  fetch(`${API_URL}?type=stats_view`).then(r => r.json())     
                ]);
                
                if (resSchedule.status === 'success') {
                    // å…¼å®¹ GAS å¯èƒ½å›å‚³çš„å…©ç¨®æ ¼å¼ (Object Array æˆ– 2D Array)
                    const isObj = !Array.isArray(resSchedule.data[0]);
                    setScheduleData(isObj ? resSchedule.data : sheetToObjects(resSchedule.data));
                }
                
                if (resData.status === 'success') {
                    // ä½¿ç”¨è¬èƒ½è®€å–
                    setPeopleData(processPeopleData(resData.data));
                }

                if (resStats.status === 'success') {
                    setStatsData(processStatsData(resStats.data));
                }

                setSyncStatus(`åŒæ­¥æˆåŠŸ`);
              } catch (err) {
                console.error("åŒæ­¥å¤±æ•—", err);
                setSyncStatus('é€£ç·šç™¼ç”ŸéŒ¯èª¤');
              } finally {
                setIsSyncing(false);
              }
            };
            loadAllData();
          }, []);
          
          const handleLogin = (e) => {
            e.preventDefault();
            const trimmedName = name.trim();
            if (!trimmedName) return setLoginError('è«‹è¼¸å…¥å§“å');
            
            const userExists = peopleData.some(p => p.name === trimmedName);
            if (userExists || peopleData.length === 0) { // å¯¬é¬†ç™»å…¥
                setCurrentView('mySchedule');
                setLoginError('');
            } else {
                setLoginError('æ‰¾ä¸åˆ°æ­¤å§“å');
            }
          };

          const renderView = () => {
            switch (currentView) {
              case 'login': return <LoginView name={name} setName={setName} onLogin={handleLogin} loginError={loginError} isSyncing={isSyncing} syncStatus={syncStatus} />;
              case 'mySchedule': return <MyScheduleView name={name} scheduleData={scheduleData} onLogout={() => setCurrentView('login')} onRequestSwap={(req) => { setSwapRequest(req); setCurrentView('swapSearch'); }} />;
              case 'swapSearch': return <SwapSearchView name={name} scheduleData={scheduleData} peopleData={peopleData} statsData={statsData} onBack={() => setCurrentView('mySchedule')} onLogout={() => setCurrentView('login')} initialRequest={swapRequest} />;
              default: return <LoginView name={name} setName={setName} onLogin={handleLogin} />;
            }
          };

          return <div className="min-h-screen bg-slate-50 font-sans text-slate-900">{renderView()}</div>;
        }

        // --- Views ---
        function LoginView({ name, setName, onLogin, loginError, isSyncing, syncStatus }) {
          return (
            <div className="min-h-screen flex items-center justify-center p-6 bg-slate-100">
              <div className="bg-white rounded-[2.5rem] shadow-2xl w-full max-w-md p-10 border border-white">
                <div className="text-center mb-10">
                  <div className="bg-indigo-600 w-24 h-24 rounded-[2rem] flex items-center justify-center mx-auto mb-6 shadow-xl shadow-indigo-200 rotate-3"><Calendar className="w-12 h-12 text-white" /></div>
                  <h2 className="text-2xl sm:text-3xl font-bold text-slate-800 tracking-tight">TBC å´‡æ‹œæœäº‹æŸ¥è©¢ç³»çµ±</h2>
                  <p className="text-slate-400 mt-2 font-medium">è¼¸å…¥å®Œæ•´å§“å</p>
                </div>
                <form onSubmit={onLogin} className="space-y-4">
                  <div className="relative">
                    <User className="absolute left-5 top-1/2 -translate-y-1/2 text-slate-300 w-6 h-6" />
                    <input type="text" value={name} onChange={(e) => setName(e.target.value)} className="w-full pl-14 pr-6 py-5 rounded-2xl border-2 border-slate-100 bg-slate-50 focus:bg-white focus:border-indigo-500 outline-none transition-all text-xl font-bold placeholder:text-slate-300" placeholder="ä¾‹å¦‚ï¼šå¼µå°æ˜" required />
                  </div>
                  {loginError && <div className="flex items-center gap-2 text-red-500 bg-red-50 p-3 rounded-xl text-sm font-bold"><AlertCircle size={16} /><span>{loginError}</span></div>}
                  <button type="submit" className="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-black py-5 rounded-2xl shadow-lg shadow-indigo-100 transition-all active:scale-95 text-lg">ç™»å…¥ç³»çµ±</button>
                </form>
                <div className="mt-8 pt-6 border-t border-slate-100 text-center text-xs font-bold text-slate-400">
                   {isSyncing ? <span className="flex items-center justify-center gap-2"><RefreshCw size={12} className="animate-spin" /> è¼‰å…¥è³‡æ–™ä¸­...</span> : syncStatus}
                </div>
              </div>
            </div>
          );
        }

        function MyScheduleView({ name, scheduleData, onLogout, onRequestSwap }) {
          const [flatShifts, setFlatShifts] = useState([]);
          const numberedRoles = ['æ¥å¾…', 'æ”¶å¥‰ç»', 'ä¸»é¤', 'æ–°æœ‹å‹é—œæ‡·']; 

          useEffect(() => {
            const searchName = name.trim();
            const tempShifts = [];
            scheduleData.forEach(row => {
              const dateStr = normalizeDateStr(row['æ—¥æœŸ']);
              if (!dateStr) return;
              const dateObj = parseDateObj(row['æ—¥æœŸ']);
              const session = row['å ‚åˆ¥'];
              
              Object.entries(row).forEach(([key, val]) => {
                if (['å ‚åˆ¥', 'æ—¥æœŸ'].includes(key)) return;
                const cellValue = String(val || '');
                if (cellValue.includes(searchName)) {
                   let shiftNumber = null;
                   if (numberedRoles.includes(key)) {
                       const names = cellValue.split(/,|ã€|ï¼Œ|\s+/).map(n => n.trim()).filter(n => n);
                       const idx = names.indexOf(searchName);
                       if (idx !== -1) shiftNumber = idx + 1;
                   }
                   tempShifts.push({ date: dateStr, dateObj, role: key, shiftNumber, session, rawSession: session });
                }
              });
            });
            const shiftsMap = new Map();
            tempShifts.forEach(shift => {
               const key = shift.role === 'åŸ·äº‹è¼ªå€¼' ? `${shift.date}|${shift.role}` : `${shift.date}|${shift.role}|${shift.session}`;
               if (shiftsMap.has(key)) {
                   const existing = shiftsMap.get(key);
                   if (!existing.session.includes(shift.session)) existing.session += `, ${shift.session}`;
               } else {
                   shiftsMap.set(key, { ...shift });
               }
            });
            setFlatShifts(Array.from(shiftsMap.values()).sort((a, b) => a.dateObj - b.dateObj));
          }, [name, scheduleData]);

          return (
            <div className="min-h-screen bg-slate-50 flex flex-col">
              <nav className="bg-white sticky top-0 z-50 border-b border-slate-100 px-6 py-4 flex justify-between items-center">
                <div className="flex items-center gap-3">
                  <div className="bg-indigo-100 p-2 rounded-xl text-indigo-600"><User size={20} /></div>
                  <div><p className="text-[10px] text-slate-400 font-bold uppercase">system user</p><h2 className="text-lg font-black text-slate-800">{name}</h2></div>
                </div>
                <button onClick={onLogout} className="flex items-center gap-2 bg-slate-100 px-4 py-2 rounded-xl text-slate-500 font-bold hover:text-red-500 hover:bg-red-50 transition-colors"><LogOut size={18}/><span>ç™»å‡º</span></button>
              </nav>
              <main className="flex-grow p-6 space-y-4 max-w-2xl mx-auto w-full">
                <div className="flex items-center gap-2 mb-2"><Calendar className="text-indigo-500" size={20} /><h3 className="text-lg sm:text-xl font-bold text-slate-800">æœ¬å­£å´‡æ‹œæœäº‹å®‰æ’</h3></div>
                {flatShifts.length > 0 ? (
                  flatShifts.map((shift, index) => {
                    const rConfig = ROLE_CONFIG[shift.role] || ROLE_CONFIG['é è¨­'];
                    const textColorClass = rConfig.color.split(' ')[1] || 'text-slate-800';
                    return (
                      <div key={index} className="bg-white rounded-[1.5rem] p-5 shadow-sm border border-slate-200 flex items-center justify-between gap-4 animate-in fade-in" style={{animationDelay: `${index * 50}ms`}}>
                        <div className="flex flex-col gap-1 flex-grow">
                           <span className={`text-xl font-black tracking-tight leading-tight ${textColorClass} flex items-center gap-2`}>
                             {shift.role}
                             {shift.shiftNumber && <span className="flex items-center justify-center w-6 h-6 rounded-full border-2 border-current text-xs font-bold shrink-0">{shift.shiftNumber}</span>}
                           </span>
                           <div className="flex flex-wrap items-center gap-2 text-sm font-bold text-slate-500">
                              <div className="flex items-center gap-1.5"><Calendar size={14} className="text-slate-400"/><span>{shift.date}</span></div>
                              <span className="text-slate-300">|</span><span className="bg-slate-100 px-2 py-0.5 rounded text-xs">{shift.session}</span>
                           </div>
                        </div>
                        <button onClick={() => onRequestSwap({ date: shift.date, role: shift.role, session: shift.rawSession, owner: name })} className="flex flex-col items-center justify-center gap-1 bg-white hover:bg-emerald-50 text-emerald-600 px-4 py-2 rounded-xl transition-all active:scale-95 border-2 border-emerald-100 flex-shrink-0 shadow-sm">
                          <RefreshCw size={18} /><span className="text-[10px] font-bold">æ›ç­æŸ¥è©¢</span>
                        </button>
                      </div>
                    );
                  })
                ) : (
                  <div className="text-center py-20 bg-white rounded-[2rem] border-2 border-dashed border-slate-200">
                    <div className="bg-slate-50 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4 text-slate-300"><Briefcase size={40} /></div>
                    <p className="text-slate-400 font-bold text-lg">æŸ¥ç„¡è³‡æ–™</p>
                  </div>
                )}
              </main>
            </div>
          );
        }

        function SwapSearchView({ name, scheduleData, peopleData, statsData, onBack, onLogout, initialRequest }) {
          const [selectedDate, setSelectedDate] = useState(initialRequest?.date || '');
          const [selectedRole, setSelectedRole] = useState(initialRequest?.role || '');
          const [selectedSession, setSelectedSession] = useState(initialRequest?.session || '');
          const [targetOwner, setTargetOwner] = useState(initialRequest?.owner || name);
          const [candidates, setCandidates] = useState(null);

          useEffect(() => {
            if (!initialRequest) return;
            // æœå°‹é‚è¼¯
            const targetDateNorm = normalizeDateStr(initialRequest.date);
            const schedulesOnDate = scheduleData.filter(s => normalizeDateStr(s['æ—¥æœŸ']) === targetDateNorm);
            const requesterBusyDates = new Set();
            scheduleData.forEach(row => {
               if(Object.values(row).some(v => String(v).includes(targetOwner))) requesterBusyDates.add(normalizeDateStr(row['æ—¥æœŸ']));
            });

            let potential = [];
            peopleData.forEach(person => {
              if (person.name === targetOwner) return;
              if (person.willingness.includes('ä¼‘æ¯') || person.willingness.includes('æš«åœ')) return;
              if (!person.roles[initialRequest.role]) return;
              if (initialRequest.role !== 'åŸ·äº‹è¼ªå€¼' && person.session !== 'çš†å¯' && !person.session.includes(initialRequest.session)) return;
              
              // æª¢æŸ¥ç•¶å¤©æ˜¯å¦å¿™ç¢Œ
              let isBusy = false;
              schedulesOnDate.forEach(s => {
                 if(Object.values(s).some(v => String(v).includes(person.name))) isBusy = true;
              });
              if(isBusy) return;

              // è¨ˆç®—å¯äº¤æ›
              const swapOptions = [];
              scheduleData.forEach(row => {
                 const rDate = normalizeDateStr(row['æ—¥æœŸ']);
                 if(rDate === targetDateNorm || requesterBusyDates.has(rDate)) return;
                 let roleOnDay = null;
                 Object.entries(row).forEach(([k, v]) => {
                    if(['æ—¥æœŸ','å ‚åˆ¥'].includes(k)) return;
                    if(String(v).includes(person.name)) roleOnDay = k;
                 });
                 if(roleOnDay) swapOptions.push({ date: rDate, role: roleOnDay });
              });

              potential.push({ ...person, swapOptions, stats: statsData[person.name] || 0 });
            });

            potential.sort((a, b) => a.stats - b.stats);
            setCandidates(potential);
          }, [initialRequest, scheduleData, peopleData, statsData]);

          return (
            <div className="min-h-screen bg-slate-50 flex flex-col">
              <nav className="bg-white sticky top-0 z-50 border-b border-slate-100 px-6 py-4 flex justify-between items-center">
                <div className="flex items-center gap-4">
                  <button onClick={onBack} className="bg-slate-100 p-2 rounded-xl text-slate-600 hover:bg-slate-200 transition-colors"><ArrowLeft size={20}/></button>
                  <div><h2 className="text-xl font-black text-slate-800">ä¸Šä¸€é </h2></div>
                </div>
                <button onClick={onLogout} className="flex items-center gap-2 bg-slate-100 px-4 py-2 rounded-xl text-slate-500 font-bold hover:text-red-500 hover:bg-red-50 transition-colors"><LogOut size={18}/><span>ç™»å‡º</span></button>
              </nav>
              <main className="flex-grow p-6 space-y-6 max-w-2xl mx-auto w-full">
                <div className="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-200">
                   <h3 className="text-xs font-bold text-slate-400 uppercase tracking-widest mb-3">å¹«ä»Šå¤©çš„æœäº‹æ‰¾åˆé©äººé¸ï¼š</h3>
                   <div className="flex items-center gap-4">
                      <div className="bg-indigo-50 p-4 rounded-2xl text-indigo-600"><Calendar size={28} /></div>
                      <div>
                         <p className="text-2xl font-black text-slate-800">{normalizeDateStr(selectedDate)}</p>
                         <div className="flex items-center gap-2 mt-1">
                            <span className="text-sm font-bold text-slate-600 bg-slate-100 px-2 py-0.5 rounded">{selectedRole}</span>
                            {selectedRole !== 'åŸ·äº‹è¼ªå€¼' && <span className="text-sm font-bold text-slate-400">â€¢ {selectedSession}</span>}
                         </div>
                      </div>
                   </div>
                </div>
                {candidates && (
                  <div className="space-y-4 animate-in fade-in">
                    <div className="flex items-center justify-between px-2">
                      <h3 className="font-black text-slate-700 flex items-center gap-2"><UserCheck className="text-emerald-500" /> æ¨è–¦äººé¸ ({candidates.length})</h3>
                      <span className="text-[10px] bg-slate-200 text-slate-500 px-2 py-1 rounded">ä¾æœäº‹æ¬¡æ•¸æ’åº</span>
                    </div>
                    {candidates.length > 0 ? (
                      candidates.map((person, idx) => (
                          <div key={idx} className="bg-white p-5 rounded-2xl border border-slate-100 shadow-sm transition-all hover:shadow-md">
                            <div className="flex items-center justify-between">
                              <div className="flex items-center gap-4">
                                <div className={`w-10 h-10 rounded-full flex items-center justify-center font-black text-white shadow-md ${idx < 3 ? 'bg-emerald-500' : 'bg-slate-300'}`}>{idx + 1}</div>
                                <div>
                                  <div className="flex items-center gap-2">
                                    <p className="text-xl font-black text-slate-800">{person.name}</p>
                                    {person.swapOptions.length > 0 ? (
                                      <span className="flex items-center gap-1 text-[10px] font-bold bg-indigo-50 text-indigo-600 px-2 py-0.5 rounded-full border border-indigo-100"><ArrowLeftRight size={10} /> æ›ç­</span>
                                    ) : (
                                      <span className="flex items-center gap-1 text-[10px] font-bold bg-orange-50 text-orange-600 px-2 py-0.5 rounded-full border border-orange-100"><HandHeart size={10} /> æ›¿è£œ</span>
                                    )}
                                  </div>
                                  <div className="flex items-center gap-1 text-xs font-bold text-slate-400 mt-1">
                                    <span className="bg-slate-100 px-1.5 py-0.5 rounded">{person.session}</span>
                                    <span>â€¢</span>
                                    <span>æœ¬å­£ {person.stats} æ¬¡</span>
                                    
                                    {/* â˜…â˜…â˜… ğŸ…· æ¨™è¨˜ â˜…â˜…â˜… */}
                                    {(person.groupId === 'FA' || person.groupId === 'FB') && (
                                        <span className="ml-1 w-5 h-5 rounded bg-slate-600 text-white flex items-center justify-center text-[10px] font-bold" title="ç¾¤çµ„: FA/FB">H</span>
                                    )}

                                    {/* â˜…â˜…â˜… ğŸ…µ æ¨™è¨˜ â˜…â˜…â˜… */}
                                    {(person.session2 === '1' || person.session2 === '2') && (
                                        <span className="ml-1 w-5 h-5 rounded bg-slate-600 text-white flex items-center justify-center text-[10px] font-bold" title="äºŒå ‚æœäº‹">F</span>
                                    )}
                                  </div>
                                </div>
                              </div>
                            </div>
                            {person.swapOptions.length > 0 && (
                              <div className="mt-4 pt-3 border-t border-slate-50">
                                <p className="text-[10px] font-bold text-slate-400 mb-2 flex items-center gap-1"><RefreshCw size={10} /> é›™æ–¹å¯ä»¥æ›ç­æ—¥æœŸ (äº’æ›ç­æ¬¡)ï¼š</p>
                                <div className="flex flex-wrap gap-2">
                                  {person.swapOptions.map((swap, i) => (
                                    <div key={i} className="text-xs bg-indigo-50 text-indigo-600 px-3 py-1.5 rounded-lg border border-indigo-100 flex items-center gap-1">
                                      <span className="font-bold">{swap.date}</span>
                                      <span className="text-[10px] opacity-70">({swap.role})</span>
                                    </div>
                                  ))}
                                </div>
                              </div>
                            )}
                          </div>
                      ))
                    ) : (
                      <div className="p-10 text-center text-slate-400 bg-white rounded-2xl border border-dashed border-slate-200">
                        <UserX className="mx-auto mb-4 opacity-30" size={48} /><p>æ‰¾ä¸åˆ°äººé¸</p>
                      </div>
                    )}
                  </div>
                )}
              </main>
            </div>
          );
        }

        const container = document.getElementById('root');
        const root = createRoot(container);
        root.render(<App />);
    </script>
</body>
</html>
